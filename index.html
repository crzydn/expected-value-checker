<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>トレカ期待値チェッカー β</title>
<meta name="description" content="遊戯王・ポケカ・ヴァイスなどのトレカボックス期待値ランキング。平均買取・回収率を自動で比較。">
<meta property="og:title" content="トレカ期待値チェッカー β">
<meta property="og:description" content="遊戯王・ポケカ・ヴァイス・デュエマ対応の期待値比較ツール">
<meta property="og:type" content="website">
<meta name="robots" content="index,follow">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.tailwindcss.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/dataTables.tailwindcss.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
</head>

<body class="bg-gray-50 text-gray-900">
  <header class="text-center py-6 border-b border-gray-300 bg-white shadow-sm">
    <h1 class="text-3xl font-bold text-yellow-600">トレカ期待値チェッカー β</h1>
    <p class="text-sm text-gray-600 mt-1">遊戯王・ポケカ・ヴァイス・デュエマ対応</p>
  </header>

  <main class="max-w-7xl mx-auto px-4 py-8">
    <section id="ranking" class="mb-12">
      <h2 class="text-2xl font-semibold mb-3">📊 最新ランキング</h2>
      <table id="torekaTable" class="stripe hover w-full text-sm"></table>
      <p class="text-xs text-gray-500 mt-2">※PRを含みます。データは参考値であり、投資助言を目的としません。</p>
    </section>

    <section id="calc" class="bg-white rounded-xl shadow p-6">
      <h2 class="text-xl font-semibold mb-2">🧮 自分で計算してみる</h2>
      <form id="calcForm" class="grid grid-cols-2 gap-4">
        <label>パック単価 <input type="number" id="packPrice" class="border p-2 w-full" value="200"></label>
        <label>パック数 <input type="number" id="packCount" class="border p-2 w-full" value="30"></label>
        <label>レア1 平均買取 <input type="number" id="r1avg" class="border p-2 w-full" value="900"></label>
        <label>レア1 封入数 <input type="number" id="r1cpb" class="border p-2 w-full" value="3"></label>
        <label>レア2 平均買取 <input type="number" id="r2avg" class="border p-2 w-full" value="450"></label>
        <label>レア2 封入数 <input type="number" id="r2cpb" class="border p-2 w-full" value="6"></label>
      </form>
      <button id="calcBtn" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded mt-4">計算する</button>
      <div id="calcResult" class="mt-4 text-lg font-semibold"></div>
    </section>
  </main>

  <footer class="text-center text-gray-600 text-sm py-6 border-t border-gray-200 bg-gray-100">
    <p>© 2025 トレカ期待値チェッカー β | 参考データ：CardRush / yugioh-starter.com</p>
  </footer>

<script src="js/main.js">
  // js/main.js
$(document).ready(function () {
  fetch("data/torekadata.json")
    .then((r) => r.json())
    .then((data) => initTable(data))
    .catch(() => $("#torekaTable").html("<tr><td>データを読み込めませんでした。</td></tr>"));

  function initTable(data) {
    const columns = [
      { title: "ゲーム", data: "game" },
      { title: "ボックス名", data: "boxName" },
      { title: "発売日", data: "releaseDate" },
      { title: "箱価格", data: "boxPrice" },
      { title: "期待値(合計)", data: "avgBuyTotal" },
      { title: "1パックEV", data: "packEV" },
      { title: "回収率", data: "roi_pct" },
      {
        title: "アフィリンク",
        data: "affiliateUrl",
        render: function (url, type, row) {
          return `<a href="${url}" target="_blank" class="text-yellow-600 underline">見る</a>`;
        },
      },
    ];

    $("#torekaTable").DataTable({
      data: data,
      columns: columns,
      order: [[6, "desc"]],
      pageLength: 10,
      responsive: true,
    });
  }

  // 計算フォーム
  $("#calcBtn").on("click", function () {
    const packPrice = parseFloat($("#packPrice").val()) || 0;
    const packCount = parseFloat($("#packCount").val()) || 0;
    const rarities = [
      { avg: parseFloat($("#r1avg").val()) || 0, cpb: parseFloat($("#r1cpb").val()) || 0 },
      { avg: parseFloat($("#r2avg").val()) || 0, cpb: parseFloat($("#r2cpb").val()) || 0 },
    ];
    const boxPrice = packPrice * packCount;
    const avgBuyTotal = rarities.reduce((s, r) => s + r.avg * r.cpb, 0);
    const packEV = (avgBuyTotal / packCount).toFixed(0);
    const roi = (avgBuyTotal / boxPrice).toFixed(2);
    const roiPct = (roi * 100).toFixed(1) + "%";
    $("#calcResult").html(`箱価格：${boxPrice}円 ／ 期待値：${avgBuyTotal}円 ／ ROI：${roiPct}`);
  });
});

</script>
</body>
</html>
